{% extends 'layout.html' %}

{% block title %}Управление дисциплинами{% endblock %}

{% block content %}
<h1>Управление дисциплинами</h1>
<p>Добро пожаловать, {{ user.fio }}!</p>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div style="color: {% if category == 'success' %}green{% else %}red{% endif %};">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('manage_courses_bp.toggle_enrollment') }}">
    <button type="submit">
        {% if settings and settings.is_enrollment_open %}
            Закрыть запись на дисциплины
        {% else %}
            Открыть запись на дисциплины
        {% endif %}
    </button>
</form>

<form action="{{ url_for('manage_courses_bp.upload_plan') }}" method="post" enctype="multipart/form-data">
    <input type="file" name="plan_file" accept=".xls,.xlsx" required>
    <button type="submit">Загрузить учебный план</button>
</form>

{% if elective_courses %}
    <h2>Дисциплины по выбору</h2>
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Название дисциплины</th>
                <th>Семестр</th>
                <th>Направление</th>
            </tr>
        </thead>
        <tbody>
            {% for course in elective_courses %}
                <tr>
                    <td>{{ course.name }}</td>
                    <td>{{ course.semester }}</td>
                    <td>{{ course.direction.name }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}

<br>
<a href="{{ url_for('manage_students_courses') }}">Управление студентами и дисциплинами</a><br>
<a href="{{ url_for('reports_bp.generate_reports') }}">Сгенерировать отчет</a>
<a href="{{ url_for('director_dashboard') }}">Панель управления</a><br>
<a href="{{ url_for('logout') }}">Выйти</a>
{% endblock %}
